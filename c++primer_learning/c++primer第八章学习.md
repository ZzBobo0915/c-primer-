# c++primer学习

## 第8章 IO库

#### 8.1 IO类

![8-1](E:\朱智博-文件杂项\c++\c++primer学习图片\8-1.png)

##### 1.IO对象无拷贝或赋值

​    我们不能拷贝或者对IO对象赋值，对IO进行操作的函数通常以引用方式传递和返回流。

```c++
ofstream out1, out2;
out1 = out2;               //不能对流对象赋值
ofstream print(ofstream);  //错误：不能初始化ofstream参数
out2 = print(out2);        //错误：不能拷贝流对象
```

##### 2.条件状态

![8-2](E:\朱智博-文件杂项\c++\c++primer学习图片\8-2.png)

![8-3](E:\朱智博-文件杂项\c++\c++primer学习图片\8-3.png)

​    IO库定义了一个与机器无关的iostate类型，它提供了表达流状态的完整功能。

```c++
auto old_state = cin.rdstate();  //记住cin的当前状态
cin.clear();                     //使cin有效
process_input(cin);              //使用cin
cin.setstate(old_state);         //将cin置为原有状态
```

##### 3.管理输出缓冲

​    每个输出流都管理一个缓冲区，用来保存程序读写的数据。

###### 1.导致缓冲刷新(即，数据真正写到输出设备或文件)的原因有很多：

- 程序正常结束，作为main函数的return操作的一部分，缓冲刷新被执行。
- 缓冲区满时，需要刷新缓冲，而后新的数据才能继续写入缓冲区。
- 我们可以使用操作符endl来显示刷新缓冲区。
- 在每个输出操作之后，我们可以用操作符unitbuf设置流的内部状态，来清空缓冲区。默认情况下，对cerr使设置unitbuf的，因此写道cerr的内容都是立即刷新的。
- 一个输出流可能被关联到另一个流。在这种情况下，当读写被关联的流时，关联到的流的缓冲区会被刷新。

###### 2.刷新输出缓冲区

​    endl、flush、ends

``` c++
cout << "hi!" << endl;   //输出hi和一个换行，然后刷新缓冲区
cout << "hi!" << flush;  //输出hi，然后刷新缓冲区，不附加任何额外字符
cout << "hi!" << ends;   //输出hi和一个空字符，然后刷新缓冲区
```

​    如果想再每次输出操作后都刷新缓冲区，我们可以使用unitbuf操作符。

```c++
cout << unitbuf;    //所有输出操作后都会立刻刷新缓冲区
cout << nounitbuf;  //回到正常的缓冲方式
```

#### 8.2 文件输入输出

![8-4](E:\朱智博-文件杂项\c++\c++primer学习图片\8-4.png)

##### 1.使用文件流对象

​    创建文件流对象时，我们可以提供文件名(可选的)。如果提供了一个文件名，则open会被自动调用。

```c++
ifstream in(file);  //构造一个ifstream并打开给定文件
ofstream out;       //输出文件流未关联到任何文件
```

​    **ps：当一个fstream对象被销毁时，close会自动被调用**

##### 2.文件模式

​    每个流有一个关联的文件模式，用来指出如何使用文件。

![8-5](E:\朱智博-文件杂项\c++\c++primer学习图片\8-5.png)

- 只可以对 ofstream或 fstream 对象设定 out 模式。
- 只可以对ifstream或 fstream 对象设定 in模式。
- 只有当 out也被设定时才可设定 trunc模式。
- 只要trunc没被设定，就可以设定 app模式。
- 在 app模式下，即使没有显式指定out 模式，文件也总是以输出方式被打开。
- 默认情况下，即使我们没有指定 trunc，以out 模式打开的文件也会被截断。为了保留以 out 模式打开的文件的内容，我们必须同时指定 app模式，这样只会将数据追加写到文件末尾;或者同时指定 in 模式，即打开文件同时进行读写操作。
- ate 和binary 模式可用于任何类型的文件流对象，且可以与其他任何文件模式组合使用。

#### 8.3 string流

![8-6](E:\朱智博-文件杂项\c++\c++primer学习图片\8-6.png)

