### MySQL的框架

​    主要由Server层和存储引擎两部分

​    Server：连接器，查询缓存，分析器，优化器，执行器；涵盖了MySQL的大多数核心服务功能

​    存储引擎负责：数据的存储与提取，支持MyISAM与InnoDB等

### 数据库的三范式

1. 第一范式：强调的是原子性，即数据库表的每一列都是不可分割的原子数据项
2. 第二范式：要求实体的属性完全依赖于主关键字。所谓完全依赖是指不能存在仅依赖主关键字一部分的属性
3. 第三范式：任何非主属性不依赖其他属性

### char和varchar的区别

- char(n)：固定长度类型；效率高，但是占用空间
- varchar(n)：可变长度，存储的值是每个值占的字节再加上一个用来记录其他长度的字节的长度

### 索引的理解

​    索引的出现是为了提高数据的查询效率，同样索引也会带来很多负担，创建索引和维护索引需要消耗时间，并且占据物理空间；同时会降低更新表的速度，因为更新表的时候不仅要保存数据，还需要保存索引文件。

​    建立索引的原则：

- 在最频繁使用的、用以缩小查询范围的字段上建立索引
- 在频繁使用的、需要排序的字段上建立索引

### B+树的理解

- B+树是基于B树和叶子节点顺序访问指针实现的，具有B树的平衡性，并且通过顺序访问指针提高区间查询的性能
- 在B+树中，一个节点的key从左到右非递减排列
- 进行查找操作，首先在根节点二分查找，找到一个key所在的指针，然后递归地在指针所指向的节点查找，直到找到叶子节点，然后再叶子节点上二分查找，找出key对应的data
- 插入、删除会破坏树的平衡性，因此插入删除之后需要对树进行操作维护平衡性

### B树与B+树的区别

- B+树叶子节点保存了完整的索引与数据，而非叶子节点只保留索引值，因此查询时间为O(logN)；而B树每个节点都保留索引和数据
- B+范围查找只需要遍历叶子节点链表，而B树却需要重复的中序遍历
- B+适合外部存储，因为非叶子节点不存储数据，只保存索引

### 索引的分类

- 从数据结构角度分析
    1. 树索引
    2. Hash索引
- 从物理存储角度看
    1. 聚簇索引
    2. 非聚簇索引
- 从逻辑角度看
    1. 普通索引
    2. 唯一索引
    3. 主键索引
    4. 联合索引
    5. 全文索引

### 聚簇索引与非聚簇索引

​    聚簇索引是磁盘上实际数据重新组织按照一个或多个列的值排序的算法，特点是存储数据的顺序和索引顺序一样。一般主键会默认创建聚簇索引，且一张表只能有一个聚簇索引。

​    非聚簇索引与聚簇索引的区别就是：聚簇索引的叶子节点就是数据节点，而非聚簇索引的叶子节点仍是索引节点，指向对应数据块的指针(指向聚簇索引)

### 哈希索引

​    哈希索引可以O(1)的速度进行查找，但是失去了有序性，无法用于分组、排序，只能支持精确查找，无法用于部分和范围查找。

​    InnoDB有一种自适应哈希索引，当某个索引值被频繁使用时，在B+树的索引基础上会再创建一个哈希索引，这样就让B+树具有哈希索引的优点

### 最左前缀原则

​    MySQL使用联合索引时需要满足最左前缀原则，B+树是按照从左到右的顺序来建立搜索树的。比如按照(name, age, sex)来检索，当(朱，25，男)这样的数据来检索时，B+树会优先比较name来确定下一步所搜方向，根据name再比较age、sex，最后得到索引的数据。当 (朱, 男) 这样的数据来检索时，B+ 树可以用 name 来指定搜索方向，但下一个字段 age 的缺失，所以只能把名字等于朱的数据都找到，然后再匹配性别是男的数据了， 这个是非常重要的性质，即索引的最左匹配特性。

​    最左前缀原则会一直向右匹配直到遇到查找范围(<，>，BETWEEN，LIKE)就停止匹配；并且=和IN可以乱序

### 什么情况不用索引

1. 索引列参与表达式计算
2. 函数运算
3. %语句%这种模糊查询
4. 字符串与数字比较
5. 查询条件中有OR
6. 正则表达式
7. 如果MySQL内部优化器估计扫描全表速度比索引快，就不会用索引

### InnoDB与MyISAM比较

- 事务：InnoDB支持，MyISAM不支持
- 全文索引：InnoDB5.6之前不支持，MyISAM支持
- 关于count()：MyISAM会直接存储总行数，InnoDB不会，需要按行扫描。对于 `SELECT count() FROM table;` 如果数据量较大，MyISAM会瞬间返回，而InnoDB会一行一行扫描
- 外键：InnoDB支持外键，MyISAM不支持
- 锁：InnoDB支持全局锁、表锁、行锁，MyISAM只支持全局锁和表锁

### 事务的特性

​    ACID，即原子性、一致性、隔离性、持久性：

- 原子性：事务是最小的执行单位，不允许分割。事务的原子性确保要么动作全部做完，要么完全不起作用
- 一致性：执行事务前后，数据库从一个一致性状态转移到另一个一致性状态
- 隔离性：并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库是独立的
- 持久性：一个事务被提交后，他对数据库中的数据的改变是永久的，即使数据库发生了故障也不应该对其有任何影响

### 事务隔离级别

1. 未提交读：最低的隔离级别，允许读取尚未提交的数据变更，可导致脏读、幻读、不可重复读
2. 提交读：允许读取并发事务已经提交的数据，可以防止脏读，但是幻读、不可重复读仍能发生
3. 可重复读：对同一字段的多次读取结果都是一致的，可以阻止脏读和不可重复读，但是幻读仍有可能发生
4. 串行化：最高隔离级别，完全符合ACID。可以防止脏读、幻读、不可重复读，但是执行效率有太低，影响程序性能，一般都不用。

### 什么是脏读、幻读、不可重复读

- 脏读：表示一个事务还未提交的数据能够被另一个事务获取。
- 不可重复读：一个事务内，多次读同一个数据，由于这个事务还没有结束，另外一个事务也访问这个数据，在第一个事务两次读取数据之间，第二个事务修改了数据，导致两次读取结果不一致，这就是不可重复读。（不可重复读在于修改：同样的条件，你读取过的数据再读出来就不一样了）
- 幻读：指同一事务内多次查询返回结果集不一样，比如事务A第一次查询有4条数据，第二次一样的查询却有2条，两次结果不一致，好像产生了幻觉，这就是幻读。（幻读在于新增或删除：同样的条件，第一次和第二次读出来的结果不一样）

